/*!
 * Copyright (c) 2026 Stefan Keim
 * MIT License â€” see LICENSE file for details
 */addProtocol("merge",async(e,i)=>{const t=e.url.replace("merge://","").split("|"),s=await Promise.all(t.map(async f=>{const d=await makeRequest({...e,url:f},i);return tile.read(new Pbf(d.data))})),[r,...g]=s;for(const f of g){if(r.layers.length!==f.layers.length)throw new Error("Layer count mismatch");for(let d=0;d<r.layers.length;d++){const n=r.layers[d],l=f.layers[d];if(n.features.length!==l.features.length)throw new Error(`Feature count mismatch in layer ${d}`);const y=n.keys.length;if(y==0){n.keys=l.keys,n.values=l.values;for(let u=0;u<n.features.length;u++)n.features[u].tags=l.features[u].tags}else{const u=n.values.length;for(let a=0;a<l.keys.length;a++)n.keys.push(l.keys[a]);for(let a=0;a<l.values.length;a++)n.values.push(l.values[a]);for(let a=0;a<n.features.length;a++){const h=n.features[a].tags,c=l.features[a].tags;for(let o=0;o<c.length;o+=2)h.push(c[o]+y,c[o+1]+u)}}}}const w=new Pbf;return tile.write(r,w),{data:w.finish()}});const shMod=self.sharedModule;let Pbf=shMod.Pbf,makeRequest=shMod.makeRequest;if(!Pbf||!makeRequest){const e="ArrayBuffer.isView",i='getResponseHeader("Content-Type")';for(const t in shMod){const s=shMod[t];if(typeof s=="function"){const r=s.toString();if(!Pbf&&r.includes(e)&&(Pbf=typeof new s=="function"?new s:s,makeRequest)||!makeRequest&&r.includes(i)&&(makeRequest=s,Pbf))break}}if(!Pbf||!makeRequest)throw new Error("Unable to find sharedModules")}const tile={read(e,i){return e.readFields((t,s,r)=>{t===3&&s.layers.push(tile.readL(r,r.readVarint()+r.pos))},{layers:[]},i)},write(e,i){if(e.layers)for(let t=0;t<e.layers.length;t++)i.writeMessage(3,tile.writeL,e.layers[t])},readV(e,i){return e.readFields((t,s,r)=>{t===1?s.string=r.readString():t===2?s.float=r.readFloat():t===3?s.double=r.readDouble():t===4?s.int=r.readVarint(!0):t===5?s.uint=r.readVarint():t===6?s.sint=r.readSVarint():t===7&&(s.bool=r.readBoolean())},{},i)},writeV(e,i){e.string!==void 0?i.writeStringField(1,e.string):e.float!==void 0?i.writeFloatField(2,e.float):e.double!==void 0?i.writeDoubleField(3,e.double):e.int!==void 0?i.writeVarintField(4,e.int):e.uint!==void 0?i.writeVarintField(5,e.uint):e.sint!==void 0?i.writeSVarintField(6,e.sint):e.bool!==void 0&&i.writeBooleanField(7,e.bool)},readF(e,i){return e.readFields((t,s,r)=>{t===1?s.id=r.readVarint():t===2?(r.readPackedVarint(s.tags),s.tags.length%2&&s.tags.unshift(0)):t===3?s.type=r.readVarint():t===4&&r.readPackedVarint(s.geometry)},{id:0,tags:[],type:0,geometry:[]},i)},writeF(e,i){e.id&&i.writeVarintField(1,e.id),e.tags&&i.writePackedVarint(2,e.tags),e.type&&i.writeVarintField(3,e.type),e.geometry&&i.writePackedVarint(4,e.geometry)},readL(e,i){return e.readFields((t,s,r)=>{t===2?s.features.push(tile.readF(r,r.readVarint()+r.pos)):t===3?s.keys.push(r.readString()):t===4?s.values.push(tile.readV(r,r.readVarint()+r.pos)):t===1?s.name=r.readString():t===5?s.extent=r.readVarint():t===15&&(s.version=r.readVarint())},{version:0,name:"",features:[],keys:[],values:[],extent:0},i)},writeL(e,i){if(e.version&&i.writeVarintField(15,e.version),e.name&&i.writeStringField(1,e.name),e.features)for(let t=0;t<e.features.length;t++)i.writeMessage(2,tile.writeF,e.features[t]);if(e.keys)for(let t=0;t<e.keys.length;t++)i.writeStringField(3,e.keys[t]);if(e.values)for(let t=0;t<e.values.length;t++)i.writeMessage(4,tile.writeV,e.values[t]);e.extent&&i.writeVarintField(5,e.extent)}};
//# sourceMappingURL=addMergeProtocol.min.js.map
