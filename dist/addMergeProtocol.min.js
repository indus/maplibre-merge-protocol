/*!
 * Copyright (c) 2026 Stefan Keim
 * MIT License â€” see LICENSE file for details
 */addProtocol("merge",async(e,i)=>{const r=e.url.replace("merge://","").split("|"),s=await Promise.all(r.map(async o=>{const d=await makeRequest({...e,url:o},i);return tile.read(new Pbf(d.data))})),[t,...f]=s;for(const o of f){if(t.layers.length!==o.layers.length)throw new Error("Layer count mismatch");for(let d=0;d<t.layers.length;d++){const l=t.layers[d],n=o.layers[d];if(l.features.length!==n.features.length)throw new Error(`Feature count mismatch in layer ${d}`);const h=l.keys.length;if(h==0){l.keys=n.keys,l.values=n.values;for(let u=0;u<l.features.length;u++)l.features[u].tags=n.features[u].tags}else{const u=l.values.length;for(let a=0;a<n.keys.length;a++)l.keys.push(n.keys[a]);for(let a=0;a<n.values.length;a++)l.values.push(n.values[a]);for(let a=0;a<l.features.length;a++){const g=l.features[a].tags,w=n.features[a].tags;for(let y=0;y<w.length;y+=2)g.push(w[y]+h,w[y+1]+u)}}}}const c=new Pbf;return tile.write(t,c),{data:c.finish()}});let Pbf=self.sharedModule.Pbf,makeRequest=self.sharedModule.makeRequest;if(!Pbf||!makeRequest){const e=self.sharedModule,i="ArrayBuffer.isView",r='getResponseHeader("Content-Type")';for(const s in e){const t=e[s];if(typeof t=="function"){const f=t.toString();if(!Pbf&&f.includes(i)&&(Pbf=typeof new t=="function"?new t:t,makeRequest)||!makeRequest&&f.includes(r)&&(makeRequest=t,Pbf))break}}if(!Pbf||!makeRequest)throw new Error("Unable to find sharedModules")}const tile={read(e,i){return e.readFields((r,s,t)=>{r===3&&s.layers.push(tile.layer.read(t,t.readVarint()+t.pos))},{layers:[]},i)},write(e,i){if(e.layers)for(let r=0;r<e.layers.length;r++)i.writeMessage(3,tile.layer.write,e.layers[r])},value:{read(e,i){return e.readFields((r,s,t)=>{r===1?s.string=t.readString():r===2?s.float=t.readFloat():r===3?s.double=t.readDouble():r===4?s.int=t.readVarint(!0):r===5?s.uint=t.readVarint():r===6?s.sint=t.readSVarint():r===7&&(s.bool=t.readBoolean())},{},i)},write(e,i){e.string!==void 0?i.writeStringField(1,e.string):e.float!==void 0?i.writeFloatField(2,e.float):e.double!==void 0?i.writeDoubleField(3,e.double):e.int!==void 0?i.writeVarintField(4,e.int):e.uint!==void 0?i.writeVarintField(5,e.uint):e.sint!==void 0?i.writeSVarintField(6,e.sint):e.bool!==void 0&&i.writeBooleanField(7,e.bool)}},feature:{read(e,i){return e.readFields((r,s,t)=>{r===1?s.id=t.readVarint():r===2?t.readPackedVarint(s.tags):r===3?s.type=t.readVarint():r===4&&t.readPackedVarint(s.geometry)},{id:0,tags:[],type:0,geometry:[]},i)},write(e,i){e.id&&i.writeVarintField(1,e.id),e.tags&&i.writePackedVarint(2,e.tags),e.type&&i.writeVarintField(3,e.type),e.geometry&&i.writePackedVarint(4,e.geometry)}},layer:{read(e,i){return e.readFields((r,s,t)=>{r===2?s.features.push(tile.feature.read(t,t.readVarint()+t.pos)):r===3?s.keys.push(t.readString()):r===4?s.values.push(tile.value.read(t,t.readVarint()+t.pos)):r===1?s.name=t.readString():r===5?s.extent=t.readVarint():r===15&&(s.version=t.readVarint())},{version:0,name:"",features:[],keys:[],values:[],extent:0},i)},write(e,i){if(e.version&&i.writeVarintField(15,e.version),e.name&&i.writeStringField(1,e.name),e.features)for(let r=0;r<e.features.length;r++)i.writeMessage(2,tile.feature.write,e.features[r]);if(e.keys)for(let r=0;r<e.keys.length;r++)i.writeStringField(3,e.keys[r]);if(e.values)for(let r=0;r<e.values.length;r++)i.writeMessage(4,tile.value.write,e.values[r]);e.extent&&i.writeVarintField(5,e.extent)}}};
//# sourceMappingURL=addMergeProtocol.min.js.map
