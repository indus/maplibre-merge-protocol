addProtocol("merge",async(e,i)=>{const t=e.url.replace("merge://","").split("|"),s=await Promise.all(t.map(async o=>{const d=await makeRequest({...e,url:o},i);return tile.read(new Pbf(d.data))})),[r,...f]=s;for(const o of f){if(r.layers.length!==o.layers.length)throw new Error("Layer count mismatch");for(let d=0;d<r.layers.length;d++){const n=r.layers[d],l=o.layers[d];if(n.features.length!==l.features.length)throw new Error(`Feature count mismatch in layer ${d}`);const g=n.keys.length;if(g==0){n.keys=l.keys,n.values=l.values;for(let u=0;u<n.features.length;u++)n.features[u].tags=l.features[u].tags}else{const u=n.values.length;for(let a=0;a<l.keys.length;a++)n.keys.push(l.keys[a]);for(let a=0;a<l.values.length;a++)n.values.push(l.values[a]);for(let a=0;a<n.features.length;a++){const h=n.features[a].tags,c=l.features[a].tags;for(let y=0;y<c.length;y+=2)h.push(c[y]+g,c[y+1]+u)}}}}const w=new Pbf;return tile.write(r,w),{data:w.finish()}});let Pbf=self.sharedModule.Pbf,makeRequest=self.sharedModule.makeRequest;if(!Pbf||!makeRequest){const e=self.sharedModule,i="Expected varint not more than 10 bytes",t='getResponseHeader("Content-Type")';for(const s in e){const r=e[s];if(typeof r=="function"){const f=r.toString();if(!Pbf&&f.includes(i)&&(Pbf=r,makeRequest)||!makeRequest&&f.includes(t)&&(makeRequest=r,Pbf))break}}if(!Pbf||!makeRequest)throw new Error("Unable to find sharedModules")}const tile={read(e,i){return e.readFields((t,s,r)=>{t===3&&s.layers.push(tile.layer.read(r,r.readVarint()+r.pos))},{layers:[]},i)},write(e,i){if(e.layers)for(let t=0;t<e.layers.length;t++)i.writeMessage(3,tile.layer.write,e.layers[t])},value:{read(e,i){return e.readFields((t,s,r)=>{t===1?s.string=r.readString():t===2?s.float=r.readFloat():t===3?s.double=r.readDouble():t===4?s.int=r.readVarint(!0):t===5?s.uint=r.readVarint():t===6?s.sint=r.readSVarint():t===7&&(s.bool=r.readBoolean())},{},i)},write(e,i){e.string!==void 0?i.writeStringField(1,e.string):e.float!==void 0?i.writeFloatField(2,e.float):e.double!==void 0?i.writeDoubleField(3,e.double):e.int!==void 0?i.writeVarintField(4,e.int):e.uint!==void 0?i.writeVarintField(5,e.uint):e.sint!==void 0?i.writeSVarintField(6,e.sint):e.bool!==void 0&&i.writeBooleanField(7,e.bool)}},feature:{read(e,i){return e.readFields((t,s,r)=>{t===1?s.id=r.readVarint():t===2?r.readPackedVarint(s.tags):t===3?s.type=r.readVarint():t===4&&r.readPackedVarint(s.geometry)},{id:0,tags:[],type:0,geometry:[]},i)},write(e,i){e.id&&i.writeVarintField(1,e.id),e.tags&&i.writePackedVarint(2,e.tags),e.type&&i.writeVarintField(3,e.type),e.geometry&&i.writePackedVarint(4,e.geometry)}},layer:{read(e,i){return e.readFields((t,s,r)=>{t===2?s.features.push(tile.feature.read(r,r.readVarint()+r.pos)):t===3?s.keys.push(r.readString()):t===4?s.values.push(tile.value.read(r,r.readVarint()+r.pos)):t===1?s.name=r.readString():t===5?s.extent=r.readVarint():t===15&&(s.version=r.readVarint())},{version:0,name:"",features:[],keys:[],values:[],extent:0},i)},write(e,i){if(e.version&&i.writeVarintField(15,e.version),e.name&&i.writeStringField(1,e.name),e.features)for(let t=0;t<e.features.length;t++)i.writeMessage(2,tile.feature.write,e.features[t]);if(e.keys)for(let t=0;t<e.keys.length;t++)i.writeStringField(3,e.keys[t]);if(e.values)for(let t=0;t<e.values.length;t++)i.writeMessage(4,tile.value.write,e.values[t]);e.extent&&i.writeVarintField(5,e.extent)}}};
//# sourceMappingURL=addMergeProtocol.min.js.map
