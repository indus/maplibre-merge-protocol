{
  "version": 3,
  "sources": ["../src/index.js"],
  "sourcesContent": ["/*!\r\n * Copyright (c) 2026 Stefan Keim\r\n * MIT License \u2014 see LICENSE file for details\r\n */\r\n\r\naddProtocol('merge', async (params, abortController) => {\r\n\r\n    const urls = params.url.replace('merge://', '').split('|');\r\n\r\n    const tiles = await Promise.all(\r\n        urls.map(async (url) => {\r\n            const resp = await makeRequest({ ...params, url }, abortController);\r\n            return tile.read(new Pbf(resp.data));\r\n        })\r\n    );\r\n\r\n    console.time(params.url);\r\n\r\n    const [geom, ...attrTiles] = tiles; // geom at index 0, all others are attr\r\n\r\n    for (const attr of attrTiles) {\r\n        if (geom.layers.length !== attr.layers.length) {\r\n            throw new Error('Layer count mismatch');\r\n        }\r\n\r\n        for (let i = 0; i < geom.layers.length; i++) {\r\n            const bl = geom.layers[i];\r\n            const al = attr.layers[i];\r\n\r\n            if (bl.features.length !== al.features.length) {\r\n                throw new Error(`Feature count mismatch in layer ${i}`);\r\n            }\r\n\r\n            // Keep track of key/value offset\r\n            const keyOffset = bl.keys.length;\r\n            if (keyOffset == 0) {\r\n                bl.keys = al.keys;\r\n                bl.values = al.values;\r\n                for (let j = 0; j < bl.features.length; j++) {\r\n                    bl.features[j].tags = al.features[j].tags;\r\n                }\r\n            } else {\r\n                const valueOffset = bl.values.length;\r\n\r\n                for (let i = 0; i < al.keys.length; i++) bl.keys.push(al.keys[i]);\r\n                for (let i = 0; i < al.values.length; i++) bl.values.push(al.values[i]);\r\n\r\n                for (let j = 0; j < bl.features.length; j++) {\r\n                    const tags = bl.features[j].tags;\r\n                    const alTags = al.features[j].tags;\r\n\r\n                    for (let k = 0; k < alTags.length; k += 2) {\r\n                        tags.push(alTags[k] + keyOffset, alTags[k + 1] + valueOffset);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    const pbf = new Pbf();\r\n    tile.write(geom, pbf);\r\n    const data = pbf.finish()\r\n\r\n    console.timeEnd(params.url);\r\n\r\n    return { data };\r\n});\r\n\r\n\r\nlet Pbf = self.sharedModule.Pbf;\r\nlet makeRequest = self.sharedModule.makeRequest;\r\n\r\n// Locate utility functions in `sharedModules` in the minified build,\r\n// since MapLibre is built with Rollup\u2019s `minifyInternalExports` enabled.\r\n// The markers have been tested for MapLibre minor versions v4.0\u2013v5.17.\r\n\r\nif (!Pbf || !makeRequest) {\r\n    const sharedModule = self.sharedModule;\r\n\r\n    const Pbf_marker = 'ArrayBuffer.isView'\r\n    const makeRequest_marker = 'getResponseHeader(\"Content-Type\")'\r\n\r\n    for (const key in sharedModule) {\r\n        const item = sharedModule[key];\r\n\r\n        if (typeof item === 'function') {\r\n            const str = item.toString();\r\n\r\n            if (!Pbf && str.includes(Pbf_marker)) {\r\n                // fix for MapLibre minor versions v5.0\u2013v5.3\r\n                Pbf = typeof new item === \"function\" ? new item : item\r\n                if (makeRequest) break;\r\n            }\r\n\r\n            if (!makeRequest && str.includes(makeRequest_marker)) {\r\n                makeRequest = item;\r\n                if (Pbf) break;\r\n            }\r\n        }\r\n    }\r\n\r\n    if (!Pbf || !makeRequest) {\r\n        throw new Error('Unable to find sharedModules');\r\n    }\r\n}\r\n\r\nconst tile = {\r\n    read(pbf, end) {\r\n        return pbf.readFields((tag, obj, pbf) => {\r\n            if (tag === 3) obj.layers.push(tile.layer.read(pbf, pbf.readVarint() + pbf.pos));\r\n        }, { layers: [] }, end);\r\n    },\r\n\r\n    write(obj, pbf) {\r\n        if (obj.layers) for (let i = 0; i < obj.layers.length; i++) pbf.writeMessage(3, tile.layer.write, obj.layers[i]);\r\n    },\r\n    value: {\r\n        read(pbf, end) {\r\n            return pbf.readFields((tag, obj, pbf) => {\r\n                if (tag === 1) obj.string = pbf.readString();\r\n                else if (tag === 2) obj.float = pbf.readFloat();\r\n                else if (tag === 3) obj.double = pbf.readDouble();\r\n                else if (tag === 4) obj.int = pbf.readVarint(true);\r\n                else if (tag === 5) obj.uint = pbf.readVarint();\r\n                else if (tag === 6) obj.sint = pbf.readSVarint();\r\n                else if (tag === 7) obj.bool = pbf.readBoolean();\r\n            }, {}, end);\r\n        },\r\n\r\n        write(obj, pbf) {\r\n            if (obj.string !== undefined) pbf.writeStringField(1, obj.string);\r\n            else if (obj.float !== undefined) pbf.writeFloatField(2, obj.float);\r\n            else if (obj.double !== undefined) pbf.writeDoubleField(3, obj.double);\r\n            else if (obj.int !== undefined) pbf.writeVarintField(4, obj.int);\r\n            else if (obj.uint !== undefined) pbf.writeVarintField(5, obj.uint);\r\n            else if (obj.sint !== undefined) pbf.writeSVarintField(6, obj.sint);\r\n            else if (obj.bool !== undefined) pbf.writeBooleanField(7, obj.bool);\r\n        }\r\n    },\r\n    feature: {\r\n        read(pbf, end) {\r\n            return pbf.readFields((tag, obj, pbf) => {\r\n                if (tag === 1) obj.id = pbf.readVarint();\r\n                else if (tag === 2) pbf.readPackedVarint(obj.tags);\r\n                else if (tag === 3) obj.type = pbf.readVarint();\r\n                else if (tag === 4) pbf.readPackedVarint(obj.geometry);\r\n            }, { id: 0, tags: [], type: 0, geometry: [] }, end);\r\n        },\r\n\r\n        write(obj, pbf) {\r\n            if (obj.id) pbf.writeVarintField(1, obj.id);\r\n            if (obj.tags) pbf.writePackedVarint(2, obj.tags);\r\n            if (obj.type) pbf.writeVarintField(3, obj.type);\r\n            if (obj.geometry) pbf.writePackedVarint(4, obj.geometry);\r\n        }\r\n    },\r\n    layer: {\r\n        read(pbf, end) {\r\n            return pbf.readFields((tag, obj, pbf) => {\r\n                if (tag === 2) obj.features.push(tile.feature.read(pbf, pbf.readVarint() + pbf.pos));\r\n                else if (tag === 3) obj.keys.push(pbf.readString());\r\n                else if (tag === 4) obj.values.push(tile.value.read(pbf, pbf.readVarint() + pbf.pos));\r\n                else if (tag === 1) obj.name = pbf.readString();\r\n                else if (tag === 5) obj.extent = pbf.readVarint();\r\n                else if (tag === 15) obj.version = pbf.readVarint();\r\n            }, { version: 0, name: \"\", features: [], keys: [], values: [], extent: 0 }, end);\r\n        },\r\n\r\n        write(obj, pbf) {\r\n            if (obj.version) pbf.writeVarintField(15, obj.version);\r\n            if (obj.name) pbf.writeStringField(1, obj.name);\r\n            if (obj.features) for (let i = 0; i < obj.features.length; i++) pbf.writeMessage(2, tile.feature.write, obj.features[i]);\r\n            if (obj.keys) for (let i = 0; i < obj.keys.length; i++) pbf.writeStringField(3, obj.keys[i]);\r\n            if (obj.values) for (let i = 0; i < obj.values.length; i++) pbf.writeMessage(4, tile.value.write, obj.values[i]);\r\n            if (obj.extent) pbf.writeVarintField(5, obj.extent);\r\n        }\r\n    }\r\n};"],
  "mappings": "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",
  "names": ["params", "abortController", "urls", "tiles", "url", "resp", "geom", "attrTiles", "attr", "i", "bl", "al", "keyOffset", "j", "valueOffset", "tags", "alTags", "k", "pbf", "sharedModule", "Pbf_marker", "makeRequest_marker", "key", "item", "str", "end", "tag", "obj"]
}
